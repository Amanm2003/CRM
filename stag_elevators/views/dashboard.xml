<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="dashboard_template" name="Lead Dashboard">
    <t t-call="website.layout">


      <!-- <div class="container mt-5">
                <h2 class="mb-4">Lead Dashboard</h2>

                <div class="alert alert-info">
                    <strong>Total Leads:</strong> <t t-esc="total_leads"/>
                </div>

                <div class="row">
                    <t t-foreach="stage_lead_counts" t-as="item">
                        <div class="col-md-4 mb-3">
                            <div class="card shadow-sm p-3">
                                <h5><t t-esc="item['stage']"/></h5>
                                <p>Leads: <strong><t t-esc="item['count']"/></strong></p>
                            </div>
                        </div>
                    </t>
                </div>
                <div class="mt-4 text-center">
                    <a href="/web#action=stag_elevators.action_crm_stage_custom" class="btn btn-primary">
                        Manage Lead Stages
                    </a>
                </div>
            </div> -->


      <html lang="en">
        <head>
          <meta charset="UTF-8" />
          <meta name="viewport" content="width=device-width, initial-scale=1.0" />
          <title>Dashboard</title>
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
          <!-- FullCalendar CSS -->
          <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />

          <style>
            body {
            background-color: #eef3fd;
            }
          </style>

        </head>
        <body>
          <div class="d-flex">
            <!-- Sidebar -->


            <!-- Main content -->
            <div class="flex-grow-1 flex-column content-wrapper">
              <!-- for impersonation -->
              <!-- <t t-if="request.session.get('original_uid')">
                <a href="/users/stop_impersonate" class="btn btn-warning">Stop Impersonation</a>
            </t> -->

              <!-- Topbar -->


              <main class="p-4">
                <!-- Lead Stats Cards -->
                <div class="mb-4">
                  <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                      <!-- <t t-esc="user_name"/>
                      <div class="divider"></div> -->
                      <li class="breadcrumb-item">

                        <a href="#">
                          <i class="bi bi-house-door"></i> Home</a>
                      </li>
                      <li class="breadcrumb-item active" aria-current="page">
                        Dashboard
                      </li>
                    </ol>
                  </nav>
                  <!-- <t t-if="request.session.get('original_uid')">
                  <div class="d-flex align-items-center gap-2">
                      <a href="/users/stop_impersonate" class="btn btn-warning btn-sm">
                          Stop Impersonation
                      </a>
                  </div>
              </t> -->
                </div>


                <div class="row g-3 mb-4 dashboard_grid" style="font-size:small;">
                  <t t-if=" request.env.user.groups_id.filtered(
                      lambda g: g.ismy and request.env['ir.model.access'].sudo().search([
                          ('group_id', '=', g.id),
                          ('model_id.model', '=', 'lead.followup'),
                          ('perm_read', '=', True)
                      ], limit=1)
                  )">
                    <!-- Total Leads Card -->
                    <div class="col-6 col-md-4 col-lg-3">
                      <div class="card card-box p-2 p-md-2 p-lg-3 text-center bg-white shadow-sm h-100" style="cursor: pointer;" onclick="window.location.href='/opportunities'"
>
                        <div class="icon">
                          <i class="bi bi-reception-4"></i>
                        </div>
                        <div class="mt-2 flex-grow-1">
                          <div class="tt">Total Leads</div>
                          <div>
                            <t t-esc="total_leads" />
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Dynamic Stage Cards -->
                    <!-- <t t-foreach="stage_lead_counts" t-as="item">
                    <div class="col-6 col-md-4 col-lg-3">
                      <div class="card card-box p-2 p-md-2 p-lg-3 text-center bg-white shadow-sm" style="cursor: pointer;" t-att-onclick="'window.open(\'%s\', \'_blank\')' % (
            '/crm_client/list' if item['stage'].lower() == 'won'
            else '/opportunities/new' if item['stage'].lower() == 'new'
            else '/opportunities/qualified' if item['stage'].lower() == 'qualified'
            else '/opportunities/Proposition' if item['stage'].lower() == 'proposition'
            else '/opportunities/hot' if item['stage'].lower() == 'hot'
            else '/opportunities/warm' if item['stage'].lower() == 'warm'
            else '/opportunities/cold' if item['stage'].lower() == 'cold'
            
            else '/opportunities'
         )">
                        <div class="icon">
                          <i class="bi bi-reception-4"></i>
                        </div>
                        <div class="mt-2 flex-grow-1">
                          <div class="tt">
                            <t t-esc="item['stage']"/>
                          </div>
                          <div>
                            <t t-if="item['stage'].lower() == 'won'">
                              <t t-esc="count_won"/>
                            </t>
                            <t t-else="">
                              <t t-esc="item['count']"/>
                            </t>
                          </div>
                        </div>
                      </div>
                    </div>
                  </t> -->

                    <t t-foreach="stage_lead_counts" t-as="item">
                      <div class="col-6 col-md-4 col-lg-3">
                        <div class="card card-box p-2 p-md-2 p-lg-3 text-center bg-white shadow-sm h-100 " style="cursor: pointer;" t-att-onclick="'window.location.href=\'%s\'' % ('/opportunities/stage?stage=%s' % item['stage'])"

                          >
                          <div class="icon">
                            <i class="bi bi-reception-4"></i>
                          </div>
                          <div class="mt-2 flex-grow-1">
                            <div class="tt">
                              <t t-esc="item['stage']"/>
 (Sales)
                            </div>
                            <div>


                              <t t-esc="item['count']"/>

                            </div>
                          </div>
                        </div>
                      </div>
                    </t>
                  </t>
                  <t t-if=" request.env.user.groups_id.filtered(
                      lambda g: g.ismy and request.env['ir.model.access'].sudo().search([
                          ('group_id', '=', g.id),
                          ('model_id.model', '=', 'crm.client'),
                          ('perm_read', '=', True)
                      ], limit=1)
                  )">
                    <t t-foreach="stage_crm_counts" t-as="item">
                      <div class="col-6 col-md-4 col-lg-3">
                        <div class="card card-box p-2 p-md-2 p-lg-3 text-center bg-white shadow-sm h-100 " style="cursor: pointer;" t-att-onclick="'window.location.href=\'%s\'' % ( '/crm/client/list?stage=%s' % item['stage'] )">
                          <div class="icon">
                            <i class="bi bi-reception-4"></i>
                          </div>
                          <div class="mt-2 flex-grow-1">
                            <div class="tt">
                              <t t-esc="item['stage']"/>
  (CRM)
                            </div>
                            <div>
                              <t t-esc="item['count']"/>

                            </div>
                          </div>
                        </div>
                      </div>
                    </t>
                  </t>
                  <t t-if=" request.env.user.groups_id.filtered(
                      lambda g: g.ismy and request.env['ir.model.access'].sudo().search([
                          ('group_id', '=', g.id),
                          ('model_id.model', '=', 'production.client'),
                          ('perm_read', '=', True)
                      ], limit=1)
                  )">
                  <t t-foreach="stage_production_counts" t-as="item">
                    <div class="col-6 col-md-4 col-lg-3">
                      <div class="card card-box p-2 p-md-2 p-lg-3 text-center bg-white shadow-sm h-100" style="cursor: pointer;" t-att-onclick="'window.location.href=\'%s\'' % ('/prod/list?stage=%s' % item['stage'])"

     >
                        <div class="icon">
                          <i class="bi bi-reception-4"></i>
                        </div>
                        <div class="mt-2 flex-grow-1">
                          <div class="tt">
                            <t t-esc="item['stage']"/>
  (Production)
                          </div>
                          <div>
                            <t t-esc="item['count']"/>

                          </div>
                        </div>
                      </div>
                    </div>
                  </t>
                  </t>




                </div>


                <t t-if="sales">
                  <!-- Calendar and Pending Leads -->
                  <div class="row g-3" style="display: flex; align-items: stretch;">
                    <!-- Left Column (Calendar) -->
                    <div class="col-md-6 d-flex">
                      <div class="container mt-4 flex-fill equal-height-box">
                        <div id="lead-calendar" class="h-100"></div>
                      </div>
                    </div>

                    <!-- Right Column (Leads List) -->
                    <div class="col-md-6 d-flex">
                      <div class="card pending-leads-box card-box p-3 flex-fill equal-height-box">
                        <h6>
                          <t t-esc="pending_stage_name" />
 Followups - <t t-esc="len(pending_followups)" />
                        </h6>

                        <!-- Scrollable area -->
                        <div style="max-height: 250px; overflow-y: auto;">
                          <table class="table table-bordered small mt-3">
                            <thead class="table-light">
                              <tr>
                                <th>Next Followup Date</th>
                                <th>Lead</th>
                                <th>Phone No</th>
                              </tr>
                            </thead>
                            <tbody>
                              <t t-if="pending_followups">
                                <t t-foreach="pending_followups" t-as="followup">
                                  <tr t-attf-onclick="window.location.href='/lead_followups/edit/#{followup.id}'" style="cursor: pointer;">
                                    <td>
                                      <t t-esc="followup.next_followup_date or ''" />
                                    </td>
                                    <td>
                                      <t t-esc="followup.lead_id.name" />
                                    </td>
                                    <td>
                                      <t t-esc="followup.lead_id.phone or 'N/A'" />
                                    </td>
                                  </tr>
                                </t>

                              </t>
                              <t t-if="not pending_followups">
                                <tr>
                                  <td colspan="3" class="text-center">No <t t-esc="pending_stage_name" />
                                  Followups</td>
                                </tr>
                              </t>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </t>
                <t t-if="crm or production">
                  <div class="row g-3" style="display: flex; align-items: stretch;">
                    <div class="col-md-6 d-flex">
                      <div class="container mt-4 flex-fill equal-height-box">
                        <div class="card shadow-sm h-100">
                          <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">AMC &amp; Followup Calendar</h5>
                          </div>
                          <div class="card-body p-3">
                            <div id="amc-calendar" class="h-100"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6 d-flex">
                      <div class="container mt-4 flex-fill equal-height-box">
                        <div class="card shadow-sm h-100">

                          <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">AMC Renewal</h5>
                          </div>
                          <div class="card-body p-3">

                            <!-- Scrollable area -->
                            <div style="max-height: 250px; overflow-y: auto;">
                              <table class="table table-bordered small mt-3">
                                <thead class="table-light">
                                  <tr>
                                    <th>Renewal Date</th>
                                    <th>Lead</th>
                                    <th>Phone No</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <t t-if="amc_renewals">
                                    <t t-foreach="amc_renewals" t-as="followup">
                                      <tr t-attf-onclick="window.location.href='/crm/client/edit/#{followup.id}'" style="cursor: pointer;">
                                        <td>
                                          <t t-esc="followup.renew_date or ''" />
                                        </td>
                                        <td>
                                          <t t-esc="followup.lead_id.name" />
                                        </td>
                                        <td>
                                          <t t-esc="followup.lead_id.phone or 'N/A'" />
                                        </td>
                                      </tr>
                                    </t>

                                  </t>
                                  <t t-if="not amc_renewals">
                                    <tr>
                                      <td colspan="3" class="text-center">No <t t-esc="pending_stage_name" />
                                        Renewals</td>
                                    </tr>
                                  </t>
                                </tbody>
                              </table>

                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </t>
                <t t-if="production">
                  <div class="row g-3" style="display: flex; align-items: stretch; position:relative; padding-top:15px;">
                    <div class="col-md-6 d-flex">
                      <div class="container mt-4 flex-fill equal-height-box">
                        <div class="card shadow-sm h-100">
                          <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Material Dispatch Calander</h5>
                          </div>
                          <div class="card-body p-3">
                            <div id="dispatch-calendar" class="h-100"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6 d-flex">
                      <div class="container mt-4 flex-fill equal-height-box">
                        <div class="card shadow-sm h-100">

                          <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Material Dispatch </h5>
                          </div>
                          <div class="card-body p-3">

                            <!-- Scrollable area -->
                            <div style="max-height: 250px; overflow-y: auto;">
                              <table class="table table-bordered small mt-3">
                                <thead class="table-light">
                                  <tr>
                                    <th>Dispatch Date</th>
                                    <th>Lead</th>
                                    <th>Phone No</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <t t-if="dispatch">
                                    <t t-foreach="dispatch" t-as="followup">
                                      <tr t-attf-onclick="window.location.href='/crm/client/edit/#{followup.id}'" style="cursor: pointer;">
                                        <td>
                                          <t t-esc="followup.material_dispatch_date or ''" />
                                        </td>
                                        <td>
                                          <t t-esc="followup.lead_id.name" />
                                        </td>
                                        <td>
                                          <t t-esc="followup.lead_id.phone or 'N/A'" />
                                        </td>
                                      </tr>
                                    </t>

                                  </t>
                                  <t t-if="not dispatch">
                                    <tr>
                                      <td colspan="3" class="text-center">No <t t-esc="pending_stage_name" />
                                        Renewals</td>
                                    </tr>
                                  </t>
                                </tbody>
                              </table>

                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </t>



              </main>


            </div>
          </div>

          <script>
            function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("show");
            }

            document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('lead-calendar');
            if (calendarEl) {
            var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
            left: 'prev',
            center: 'title',
            right: 'next'
            },
            events: '/lead/calendar/events',
            eventClick: function(info) {
            window.location.href = `/lead_followups/edit/${info.event.id}`;
            }
            });
            calendar.render();
            }




            var calendarE2 = document.getElementById('amc-calendar');
            if (calendarE2) {
            var calendar = new FullCalendar.Calendar(calendarE2, {
            initialView: 'dayGridMonth',
            headerToolbar: {
            left: 'prev',
            center: 'title',
            right: 'next'
            },
            events: '/amc/calendar/events',
            eventClick: function(info) {
            window.location.href = `/crm/client/edit/${info.event.id}`;
            }
            });
            calendar.render();
            }



            var calendarE3 = document.getElementById('dispatch-calendar');
            if (calendarE3) {
            var calendar = new FullCalendar.Calendar(calendarE3, {
            initialView: 'dayGridMonth',
            headerToolbar: {
            left: 'prev',
            center: 'title',
            right: 'next'
            },
            events: '/production/calendar/events',
            eventClick: function(info) {
            window.location.href = `/production/client/edit/${info.event.id}`;
            }
            });
            calendar.render();
            }

            });

            


          </script>

          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
          <!-- FullCalendar JS -->
          <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

        </body>
      </html>


    </t>
  </template>

</odoo>