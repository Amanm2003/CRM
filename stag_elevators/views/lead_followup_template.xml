<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="lead_followup_edit_template" name="Edit Lead Followup">
        <t t-call="website.layout">
            <div class="container mt-4 mb-4">


                <div class="d-flex justify-content-between align-items-center mb-3">
                    <!-- Breadcrumb -->
                    <nav aria-label="breadcrumb" class="mb-0">
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="/Dashboard">
                                    <i class="bi bi-house-door"/>
 Home</a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">
                                <a href="/lead_followups">Lead Followups</a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">
                                Update
                            </li>
                        </ol>
                    </nav>
                    <t t-if="request.session.get('flash_error')">
                        <div class="alert alert-danger" role="alert">
                            <t t-esc="request.session.pop('flash_error')"/>
                        </div>
                    </t>


                    <!-- Action Buttons -->
                    <div class="d-flex gap-2">
                        <!-- Upload button -->
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
                            <i class="bi bi-upload"/>
 Upload
                        </button>
                        <a href="/lead_followups" class="btn btn-dark">← Back</a>
                    </div>
                </div>

                <div id="lead_followups_update" style="background:white;">
                    <div style="padding:15px;">
                        <t t-if="request.params.get('error') == 'missing_quotation'">
                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    Quotation document must be uploaded before marking this lead as 'Won'.
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        </t>
                        
                        <t t-if="request.params.get('error') == 'followup_date_v'">
                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    Next follow-up date cannot be earlier than the existing one.
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        </t>
                        <t t-if="request.params.get('error') == 'email_error'">
                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    Please fill the valid email.
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        </t>
                        <div style="
                                position: relative;
                                margin-left: 396px;
                            ">
                            <div class="btn-group gap-2"> CRM
                        <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-success' if crm.stage1 else 'btn-danger')" data-bs-toggle="modal" data-bs-target="#Cstage1Modal" data-bs-placement="top" title="Site Visit Confirm">
                            Stage 1
                        </button>
                        <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-success' if crm.stage2 else 'btn-danger')" data-bs-toggle="modal" data-bs-target="#Cstage2Modal" data-bs-placement="top" title="Drawing Sent">
                            Stage 2
                        </button>
                        <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-success' if crm.stage3 else 'btn-danger')" data-bs-toggle="modal"  data-bs-target="#Cstage3Modal" data-bs-placement="top" title="Finishes form" >
                            Stage 3
                        </button>
                        <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-success' if crm.stage4 else 'btn-danger')" data-bs-toggle="modal"  data-bs-target="#Cstage4Modal" data-bs-placement="top" title="Rediness Form" >
                            Stage 4
                        </button>
                        <t t-if="request.env.user.groups_id.filtered(lambda g: g.is_admin and g.ismy)">
                            <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-success' if crm.stage5 else 'btn-danger')"
                                    data-bs-toggle="modal"
                                    data-bs-target="#Cstage5Modal"
                                    data-bs-placement="top"
                                    title="Readiness Notification">
                                Stage 5
                            </button>
                        </t>
                        <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-success' if crm.stage6 else 'btn-danger')" data-bs-toggle="modal" data-bs-target="#Cstage6Modal" data-bs-placement="top" title="Material Dispatch" >
                            Stage 6
                        </button>
                        <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-success' if crm.stage7 else 'btn-danger')" data-bs-toggle="modal" data-bs-target="#Cstage7Modal" data-bs-placement="top" title="Pre Installation" >
                            Stage 7
                        </button>
                        <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-success' if crm.stage8 else 'btn-danger')" data-bs-toggle="modal" data-bs-target="#Cstage8Modal" data-bs-placement="top" title="Installation Timeline / Process" >
                            Stage 8
                        </button>
                        <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-success' if crm.stage9 else 'btn-danger')" data-bs-toggle="modal" data-bs-target="#Cstage9Modal" data-bs-placement="top" title="AMC/Service" >
                            Stage 9
                        </button>

                        <!--<button class="btn btn-sm btn-outline-primary rounded-pill px-3" data-bs-toggle="modal" data-bs-target="#stage2Modal">Stage 2</button>-->
                        <!--<button class="btn btn-sm btn-outline-primary rounded-pill px-3" data-bs-toggle="modal" data-bs-target="#stage3Modal">Stage 3</button>-->
                        <!--<button class="btn btn-sm btn-outline-primary rounded-pill px-3" data-bs-toggle="modal" data-bs-target="#stage4Modal">Stage 4</button>-->
                    </div>
                            <!-- <div class="btn-group gap-2" style="
                                position: relative;
                                margin-top: 4px;
                            "> Production
                                <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-info' if prod.stage1 else 'btn-orange')" data-bs-toggle="modal" data-bs-target="#Pstage1Modal" data-bs-placement="top" title="Site Visit Confirm">
                                Stage 1
                                </button>
                                <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-info' if prod.stage2 else 'btn-orange')" data-bs-toggle="modal" data-bs-target="#Pstage2Modal" data-bs-placement="top" title="Drawing Sent">
                                Stage 2
                                </button>
                                <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-info')" data-bs-toggle="modal" data-bs-target="#Pstage3Modal" data-bs-placement="top" title="Finishes form" style="pointer-events: none; opacity: 1;">
                                Stage 3
                                </button>
                                <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-info')" data-bs-toggle="modal" data-bs-target="#Pstage4Modal" data-bs-placement="top" title="Rediness Form" style="pointer-events: none; opacity: 1;">
                                Stage 4
                                </button>
                                <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-info')" data-bs-toggle="modal"  data-bs-placement="top" title="Rediness Notification" style="pointer-events: none; opacity: 1;">
                                Stage 5
                                </button>
                                <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-info' if prod.stage6 else 'btn-orange')" data-bs-toggle="modal" data-bs-target="#Pstage6Modal" data-bs-placement="top" title="Material Dispatch">
                                Stage 6
                                </button>
                                <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-info' if prod.stage7 else 'btn-orange')" data-bs-toggle="modal" data-bs-target="#Pstage7Modal" data-bs-placement="top" title="Pre Installation">
                                Stage 7
                                </button>
                                <button t-att-class="'btn btn-sm rounded-pill px-2 ' + ('btn-info' if prod.stage8 else 'btn-orange')" data-bs-toggle="modal" data-bs-target="#Pstage8Modal" data-bs-placement="top" title="Installation Timeline / Process">
                                Stage 8
                                </button>
                            </div> -->
                        </div>

                        <!-- MAIN UPDATE FORM -->
                        <form action="/lead_followups/update" method="POST">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <input type="hidden" name="followup_id" t-att-value="followup.id"/>

                            <div class="form-group mb-3">
                                <label>Lead Name</label>
                                <p class="form-control-plaintext text-danger">
                                    <t t-esc="followup.lead_id.name"/>
 (                                    <t t-esc="followup.lead_id.city or 'Others'"/>
)
                                </p>
                            </div>

                            <div class="form-group mb-3">
                                <label>Lead Mobile</label>
                                <p class="form-control-plaintext">
                                    <t t-esc="followup.mobile or 'N/A'"/>
                                </p>
                            </div>

                            <div class="form-group mb-3">
                                <label>Lead Alternate Mobile</label>
                                <input type="text" name="alternate_mobile" class="form-control" t-att-value="followup.alternate_mobile or ''"/>
                            </div>

                            <div class="form-group mb-3">
                                <label>Email</label>
                                <input type="text" name="email" class="form-control" t-att-value="followup.lead_id.email_from or ''"/>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Lead Location</label>
                                <select name="followup.lead_id.city" class="form-control">
                                    <t t-foreach="locations" t-as="loc">
                                        <option t-att-value="loc.name" t-att-selected="loc.name == followup.lead_id.city">
                                            <t t-esc="loc.name"/>
                                        </option>
                                    </t>
                                </select>
                            </div>

                            <div class="form-group mb-3">
                                <label>Model</label>
                                <input type="text" name="lead_model" class="form-control" t-att-value="followup.lead_model or ''"/>
                            </div>

                            <div class="form-group mb-3">
                                <label for="shaft">Shaft</label>
                                <select name="shaft" class="form-control" id="shaft">
                                    <option t-att-selected="not followup.shaft" value="">-- None --</option>
                                    <option t-att-selected="followup.shaft == 'Metal'" value="Metal">Metal</option>
                                    <option t-att-selected="followup.shaft == 'Platform_lift'" value="Platform_lift">Platform Lift</option>
                                    <option t-att-selected="followup.shaft == 'Civil'" value="Civil">Civil</option>
                                </select>
                            </div>


                            <div class="form-group mb-3">
                                <label>Next Followups Date
                                    (                                    <span class="text-danger">Actual Followup Date: <t t-esc="followup.next_followup_date or ''"/>
                                    </span>)
                                </label>
                                <input type="date" name="next_followup_date" id="next_followup_date" class="form-control" required="true"/>
                            </div>

                            <!-- <div class="form-group mb-3">
                                <label>Followup Description</label>
                                <textarea name="followup_description" id="followup_description" class="form-control" rows="5" required="true"/>
                            </div> -->
                            <div class="form-group mb-3">
                                <label>Followup Description</label>
                                <input type="hidden" name="followup_description" id="followup_description"/>

                                <!-- Editor container -->
                                <div id="followup_editor" style="height:200px; background:white;"></div>
                            </div>

                            <!-- Quill JS -->
                            <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet"/>
                            <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

                            <script>
                            var quill = new Quill('#followup_editor', {
                            theme: 'snow',
                            modules: {
                                toolbar: [
                                [{ 'font': [] }, { 'size': [] }],
                                ['bold', 'italic', 'underline', 'strike'],
                                [{ 'color': [] }, { 'background': [] }],
                                [{ 'align': [] }],
                                ['link', 'clean']
                                ]
                            }
                            });

                            // On form submit, set HTML content into hidden input
                            document.querySelector('form').onsubmit = function() {
                            document.querySelector('#followup_description').value = quill.root.innerHTML;
                            };
                            </script>

                            

                            <div class="form-group mb-3">
                                <label>Lead Stage
                                    (<span class="text-danger">
                                        Current stage: <t t-esc="followup.stage_id.name or ''"/>
                                    </span>)
                                </label>
                                <select name="stage_id" class="form-control" id="stage_id_select" required="true">
                                    <option value="">-- None --</option>
                                    <t t-foreach="request.env['crm.stage'].sudo().search([('stage', '=', 'sales')])" t-as="stage">
                                        <option t-att-value="stage.id" 
                                                t-att-selected="'selected' if followup.stage_id.id == stage.id else None">
                                            <t t-esc="stage.name"/>
                                        </option>
                                    </t>
                                </select>
                            </div>


                            <!-- Won Note Field: initially hidden -->
                            <div class="form-group mb-3" id="won_note_wrapper" style="display: none;">
                                <label>Important Notes for CRM</label>
                                <textarea name="won_note" class="form-control"/>
                                    
                                <!-- </textarea> -->
                                <!-- <textarea name="won_note" class="form-control" rows="3"
                                    placeholder="Enter note for Won stage..."
                                    t-att-value="followup.won_note">
                                </textarea> -->

                                
                            </div>

                            <!-- <t t-if="followup.stage_id.name == 'Won'">
                                <div class="form-group mb-3">
                                    <label>Important Notes for CRM</label>
                                    <textarea name="won_note" class="form-control">
                                        <t t-esc="followup.won_note"/>
                                    </textarea>
                                </div>
                            </t> -->



                            <h4>Previous Followup Details</h4>
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-if="followup.followup_history">
                                        <t t-foreach="followup.followup_history.split('\n')" t-as="line">
                                            <t t-if="line">
                                                <tr>
                                                    <td>
                                                        <t t-esc="line.split(']')[0].replace('[','')"/>
                                                    </td>
                                                    <td>
                                                        <div style="max-height: 120px; overflow-y: auto;  text-align: left; ">
                                                            <t t-esc="line.split(']')[1] if ']' in line else ''"/>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </t>
                                        </t>
                                    </t>
                                    <t t-if="not followup.followup_history">
                                        <tr>
                                            <td colspan="2" class="text-center">No previous followups</td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>

                            <!-- (Optional) list already uploaded attachments -->
                            <h5 class="mt-4">Uploaded Documents</h5>
                            <t t-set="attachments" t-value="request.env['ir.attachment'].sudo().search([('res_model','=','lead.followup'), ('res_id','=',followup.id)])"/>
                            <table class="table table-sm table-striped">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Uploaded On</th>
                                        <th>Download</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-if="attachments">
                                        <t t-foreach="attachments" t-as="att">
                                            <tr>
                                                <td>
                                                    <t t-esc="att.name"/>
                                                </td>
                                                <td>
                                                    <t t-esc="att.create_date"/>
                                                </td>
                                                <td>
                                                    <a t-att-href="'/web/content/%s?download=true' % att.id" target="_blank" class="btn btn-link btn-sm">
                                                        Download
                                                    </a>
                                                    <a t-att-href="'/lead_followups/attachment/delete/%s' % att.id" class="btn btn-link btn-sm text-danger" title="Delete" onclick="return confirm('Are you sure you want to delete this document?');">
                                                        <i class="fa fa-trash"/>
                                                    </a>
                                                </td>
                                            </tr>
                                        </t>
                                    </t>
                                    <t t-if="not attachments">
                                        <tr>
                                            <td colspan="3" class="text-center">No documents uploaded</td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>

                            <div class="d-flex justify-content-end gap-2">
                                <button type="submit" class="btn btn-dark">Submit</button>
                                <a href="/lead_followups/" class="btn btn-light">Cancel</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ================= Upload Modal ================= -->
            <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <form action="/lead_followups/upload" method="POST" enctype="multipart/form-data" class="modal-content">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <input type="hidden" name="followup_id" t-att-value="followup.id"/>

                        <div class="modal-header">
                            <h5 class="modal-title" id="uploadModalLabel">Upload Lead Followup Document</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                        </div>

                        <div class="modal-body">
                            <!-- Dropdown: Quotation, Stage 1..6 -->
                            <div class="mb-3">
                                <label class="form-label">Select Stage</label>
                                <select name="stage_label" class="form-control">
                                    <option value="Quotation">Quotation</option>
                                    <option value="Stage 1">Stage 1</option>
                                    <option value="Stage 2">Stage 2</option>
                                    <option value="Stage 3">Stage 3</option>
                                    <option value="Stage 4">Stage 4</option>
                                    <option value="Stage 5">Stage 5</option>
                                    <option value="Stage 6">Stage 6</option>
                                </select>
                            </div>

                            <!-- File upload -->
                            <div class="mb-3">
                                <label class="form-label">Upload Document</label>
                                <input type="file" name="document" class="form-control" accept=".pdf,.doc,.docx,.jpg,.png" required="required"/>
                            </div>

                            <!-- Optional note -->
                            <div class="mb-3">
                                <label class="form-label">Note (optional)</label>
                                <textarea class="form-control" name="note" placeholder="Any comment..."/>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
                <!-- ========= prod stage 1 ============ -->

                <div class="modal fade" id="Pstage1Modal" tabindex="-1" aria-labelledby="stage11ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <!-- Left: Title -->
                                <h5 class="modal-title mb-0" id="Pstage1ModalLabel">Stage 1</h5>

                                <!-- Right: Close Button -->
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>


                            <!-- Modal Body -->
                            <!-- Modal Body -->
                            <div class="modal-body">
                                <form id="Pstage1Form">

                                    <!-- Upload multiple images -->
                                    <div class="mb-3">
                                        <label for="siteVisitImages" class="form-label">Site Visit Report Images</label>
                                        <input class="form-control" type="file" name="siteVisitImages[]" accept="image/*" multiple="True" t-att-disabled="True"/>
                                        <label>Attachment</label>
                                        <t t-if="prod.site_visit_images">
                                            <t t-foreach="prod.site_visit_images" t-as="att">
                                                <a t-att-href="'/web/content/%s?download=true' % att.id" target="_blank" class="ms-2 d-block" title="Download Attachment">
                                                    <i class="fa fa-download fa-lg text-primary"></i>
                                                    <t t-esc="att.name"/>
                                                </a>

                                            </t>
                                        </t>
                                        <t t-else="">
                                            <span class="text-muted">No attachment</span>
                                        </t>

                                    </div>

                                    <!-- Site Visit Person Name -->
                                    <div class="mb-3">
                                        <label for="visitPerson" class="form-label">Name of Site Visit Person</label>
                                        <input type="text" class="form-control" name="visitPerson" placeholder="Enter name" t-att-value="prod.site_visit_person" t-att-disabled="True"/>
                                    </div>

                                    <!-- Model No -->
                                    <div class="mb-3">
                                        <label for="modelNo" class="form-label">Model No</label>
                                        <select class="form-select" name="modelNo" t-att-disabled="True">
                                            <option value="" t-att-selected="not prod.model_no">-- Select Model --</option>
                                            <option value="SE1" t-att-selected="prod.model_no == 'SE1'">SE1</option>
                                            <option value="SE2" t-att-selected="prod.model_no == 'SE2'">SE2</option>
                                            <option value="SE3" t-att-selected="prod.model_no == 'SE3'">SE3</option>
                                            <option value="SE3+" t-att-selected="prod.model_no == 'SE3+'">SE3+</option>
                                            <option value="X3" t-att-selected="prod.model_no == 'X3'">X3</option>
                                            <option value="TEZ" t-att-selected="prod.model_no == 'TEZ'">TEZ</option>
                                            <option value="others" t-att-selected="prod.model_no == 'others'">Others</option>
                                        </select>
                                    </div>


                                    <!-- Shaft Type -->
                                    <div class="mb-3">
                                        <label for="shaftType" class="form-label">Shaft Type</label>
                                        <select class="form-select" name="shaftType" t-att-disabled="True">
                                            <option value="" t-att-selected="not prod.shaft_type">-- Select Shaft Type --</option>
                                            <option value="glass" t-att-selected="prod.shaft_type == 'glass'">Glass</option>
                                            <option value="3_side_wall" t-att-selected="prod.shaft_type == '3_side_wall'">3 Side Wall</option>
                                        </select>
                                    </div>

                                </form>
                            </div>



                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" t-att-checked="prod.stage1 and 'checked'" t-att-disabled="True" />
                                    <label class="form-check-label" for="stage1">
                            Stage 1 Completed
                                    </label>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>

                <!-- ========= prod stage 2 ============ -->

                <div class="modal fade" id="Pstage2Modal" tabindex="-1" aria-labelledby="stage2ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <!-- Left: Title -->
                                <h5 class="modal-title mb-0" id="Pstage2ModalLabel">Stage 2</h5>




                                <!-- Right: Close Button -->
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>


                            <!-- Modal Body -->
                            <!-- Modal Body -->
                            <div class="modal-body">
                                <form id="Pstage2Form">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" t-att-checked="prod.drawing_sent and 'checked'" t-att-disabled="True"/>
                                        <label class="form-check-label" for="drawing_sent">Drawing Sent</label>
                                        <t t-if="prod.drawing_sent_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % prod.drawing_sent_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"/>
                                                <t t-esc="prod.drawing_sent_attachment.name"/>
                                            </a>

                                        </t>
                                    </div>

                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" t-att-checked="prod.rev_1 and 'checked'" t-att-readonly="prod.rev_1 and 'readonly'" t-att-disabled="True"/>
                                        <label class="form-check-label" for="Rev_1">Rev 1</label>
                                        <t t-if="prod.rev_1_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % prod.rev_1_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"/>
                                                <t t-esc="prod.rev_1_attachment.name"/>
                                            </a>
                                        </t>
                                        <div >
                                            <input type="date" class="form-control mt-2" name="rev_1_date" t-att-value="prod.rev_1_date or ''" t-att-disabled="True"/>
                                        </div>
                                    </div>

                                    <!-- Repeat for Rev 2–5 -->
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" t-att-checked="prod.rev_2 and 'checked'" t-att-readonly="prod.rev_2 and 'readonly'" t-att-disabled="True"/>
                                        <label class="form-check-label" for="Rev_2">Rev 2</label>
                                        <t t-if="prod.rev_2_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % prod.rev_2_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"/>
                                                <t t-esc="prod.rev_2_attachment.name"/>
                                            </a>
                                        </t>
                                        <div >
                                            <input type="date" class="form-control mt-2" name="rev_2_date" t-att-value="prod.rev_2_date or ''" t-att-disabled="True"/>
                                        </div>
                                    </div>

                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" t-att-checked="prod.rev_3 and 'checked'" t-att-readonly="prod.rev_3 and 'readonly'" t-att-disabled="True"/>
                                        <label class="form-check-label" for="Rev_3">Rev 3</label>
                                        <t t-if="prod.rev_3_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % prod.rev_3_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"/>
                                                <t t-esc="prod.rev_3_attachment.name"/>
                                            </a>
                                        </t>
                                        <div >
                                            <input type="date" class="form-control mt-2" name="rev_3_date" t-att-value="prod.rev_3_date or ''" t-att-disabled="True"/>
                                        </div>
                                    </div>

                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" t-att-checked="prod.rev_4 and 'checked'" t-att-readonly="prod.rev_4 and 'readonly'" t-att-disabled="True"/>
                                        <label class="form-check-label" for="Rev_4">Rev 4</label>
                                        <t t-if="prod.rev_4_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % prod.rev_4_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"/>
                                                <t t-esc="prod.rev_4_attachment.name"/>
                                            </a>
                                        </t>
                                        <div >
                                            <input type="date" class="form-control mt-2" name="rev_4_date" t-att-value="prod.rev_4_date or ''" t-att-disabled="True"/>
                                        </div>
                                    </div>

                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" t-att-checked="prod.rev_5 and 'checked'" t-att-readonly="prod.rev_5 and 'readonly'" t-att-disabled="True"/>
                                        <label class="form-check-label" for="Rev_5">Rev 5</label>
                                        <t t-if="prod.rev_5_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % prod.rev_5_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"/>
                                                <t t-esc="prod.rev_5_attachment.name"/>
                                            </a>
                                        </t>
                                        <div >
                                            <input type="date" class="form-control mt-2" name="rev_5_date" t-att-value="prod.rev_5_date or ''" t-att-disabled="True"/>
                                        </div>
                                    </div>

                                    <div class="form-group mt-3">
                                        <label for="stage2_attachment">Upload Diagram (Choose revision):</label>
                                        <div class="d-flex gap-2 align-items-center">
                                            <select id="stage2_upload_tag" class="form-select w-25" t-att-disabled="True">
                                                <option value="drawing_sent">Drawing Sent</option>
                                                <option value="rev_1">Rev 1</option>
                                                <option value="rev_2">Rev 2</option>
                                                <option value="rev_3">Rev 3</option>
                                                <option value="rev_4">Rev 4</option>
                                                <option value="rev_5">Rev 5</option>
                                            </select>
                                            <input type="file" id="stage2_attachment" class="form-control w-50" t-att-disabled="True"/>
                                        </div>
                                    </div>




                                </form>
                            </div>



                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="stage2" t-att-checked="prod.stage2 and 'checked'" t-att-disabled="True" />
                                    <label class="form-check-label" for="stage2">
                            Stage 2 Completed
                                    </label>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <!-- ========= prod stage 6 ============ -->

                <div class="modal fade" id="Pstage6Modal" tabindex="-1" aria-labelledby="stage6ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <!-- Left: Title -->
                                <h5 class="modal-title mb-0" id="Pstage6ModalLabel">Stage 6</h5>





                                <!-- Right: Close Button -->
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>


                            <!-- Modal Body -->
                            <!-- Modal Body -->
                            <div class="modal-body">
                                <form id="Pstage6Form">
                                    <div class="border p-3 mb-3 rounded">
                                        <div class="form-check mb-2">
                                            <input type="checkbox" class="form-check-input" name="material_dispatch" id="material_dispatch" t-att-checked="prod.material_dispatch and 'checked'" t-att-disabled="True"/>
                                            <label class="form-check-label fw-bold" for="material_dispatch">Material Dispatch</label>
                                        </div>
                                        <div class="mb-2">
                                            <label>Date:</label>
                                            <input type="date" class="form-control" name="material_dispatch_date" id="material_dispatch_date" t-att-value="prod.material_dispatch_date or ''" t-att-disabled="True"/>
                                        </div>

                                        <div class="form-group mt-3">
                                            <label>Upload eBill:</label>
                                            <t t-if="prod.material_dispatch_attachment">
                                                <a t-att-href="'/web/content/%s?download=true' % prod.material_dispatch_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                    <i class="fa fa-download fa-lg text-primary"/>
                                                    <t t-esc="prod.material_dispatch_attachment.name"/>
                                                </a>
                                            </t>
                                            <input type="file" id="stage6_attachment" name="stage6_attachment" class="form-control" t-att-disabled="True"/>
                                        </div>
                                        <!-- <input type="hidden" id="client_id" t-att-value="client.id"/> -->
                                        <div class="mt-3">
                                        </div>
                                    </div>

                                    <!-- Material Delivery -->
                                    <div class="border p-3 mb-3 rounded">
                                        <div class="form-check mb-2">
                                            <input type="checkbox" class="form-check-input" name="material_delivery" id="material_delivery" t-att-checked="prod.material_delivery and 'checked'" t-att-disabled="True"/>
                                            <label class="form-check-label fw-bold" for="material_delivery">Material Delivery</label>
                                        </div>
                                        <div class="mb-2">
                                            <label>Date:</label>
                                            <input type="date" class="form-control" name="material_delivery_date" id="material_delivery_date" t-att-value="prod.material_delivery_date or ''" t-att-disabled="True"/>
                                        </div>
                                    </div>


                                </form>
                            </div>



                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="stage6" t-att-checked="prod.stage6 and 'checked'" t-att-disabled="True" />
                                    <label class="form-check-label" for="stage6">
                            Stage 6 Completed
                                    </label>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>

                <!-- ========= prod stage 7 ========= -->

                <div class="modal fade" id="Pstage7Modal" tabindex="-1" aria-labelledby="stage7ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <!-- Left: Title -->
                                <h5 class="modal-title mb-0" id="Pstage7ModalLabel">Stage 7</h5>





                                <!-- Right: Close Button -->
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>


                            <!-- Modal Body -->
                            <!-- Modal Body -->
                            <div class="modal-body">
                                <form id="Pstage7Form">

                                    <!-- Start Installation (Selection yes/no) -->
                                    <div class="mb-3">
                                        <label for="startInstallation" class="form-label">Start Installation</label>
                                        <select class="form-select" id="startInstallation" name="start_installation" t-att-disabled="True">
                                            <option value="" t-att-selected="not prod.start_installation">-- Select --</option>
                                            <option value="yes" t-att-selected="prod.start_installation == 'yes'">Yes</option>
                                            <option value="no" t-att-selected="prod.start_installation == 'no'">No</option>
                                        </select>
                                    </div>

                                    <!-- Stage 7 Attachment -->
                                    <div class="mb-3">
                                        <label for="stage7Attachment" class="form-label">Upload Attachment</label>
                                        <input class="form-control" type="file" id="stage7Attachment" name="stage7_attachment" accept="image/*,application/pdf" t-att-disabled="True"/>
                                        <t t-if="prod.stage_7_attachment">
                                            <div class="mt-2">
                                                <a t-att-href="'/web/content/%s?download=true' % prod.stage_7_attachment.id" target="_blank" class="btn btn-outline-primary btn-sm">
                                                    <i class="fa fa-download"></i>
                                                    <t t-esc="prod.stage_7_attachment.name"/>
                                                </a>
                                            </div>
                                        </t>
                                    </div>

                                </form>
                            </div>



                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="stage7" t-att-checked="prod.stage7 and 'checked'" t-att-disabled="True" />
                                    <label class="form-check-label" for="stage7">
                            Stage 7 Completed
                                    </label>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>

                <!-- ========= prod stage 8 ========= -->

                <div class="modal fade" id="Pstage8Modal" tabindex="-1" aria-labelledby="stage8ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <!-- Left: Title -->
                                <h5 class="modal-title mb-0" id="Pstage8ModalLabel">Stage 8</h5>





                                <!-- Right: Close Button -->
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>


                            <!-- Modal Body -->
                            <!-- Modal Body -->
                            <div class="modal-body">
                                <form id="Pstage8Form">
                                    <div class="form-check mb-2">
                                        <input type="checkbox" class="form-check-input" name="ongoing" id="ongoing" t-att-checked="'checked' if prod.ongoing else None" t-att-disabled="True"/>
                                        <label class="form-check-label fw-bold" for="ongoing">Ongoing</label>
                                    </div>

                                    <div class="form-check mb-2">
                                        <input type="checkbox" class="form-check-input" name="completed" id="completed" t-att-checked="'checked' if prod.completed else None" t-att-disabled="True"/>
                                        <label class="form-check-label fw-bold" for="completed">Completed</label>
                                    </div>

                                    <div class="border p-3 mb-3 rounded">
                                        <div class="form-check mb-2">
                                            <input type="checkbox" class="form-check-input" name="handover" id="handover" t-att-checked="'checked' if prod.handover else None" t-att-disabled="True"/>
                                            <label class="form-check-label fw-bold" for="handover">Handover</label>
                                            <input type="date" class="form-control mt-2" name="handover_date" id="handover_date" t-att-value="prod.handover_date or ''" t-att-readonly="'readonly' if prod.stage8 else None" t-att-disabled="True"/>
                                        </div>

                                        <div class="form-group mt-3">
                                            <label>Attachment</label>
                                            <t t-if="prod.attachment_handover">
                                                <a t-att-href="'/web/content/%s?download=true' % prod.attachment_handover.id" target="_blank" class="ms-2" title="Download Attachment">
                                                    <i class="fa fa-download fa-lg text-primary"></i>
                                                    <t t-esc="prod.attachment_handover.name"/>
                                                </a>
                                            </t>
                                            <input type="file" id="stage8_attachment" name="stage8_attachment" class="form-control" t-att-disabled="True"/>
                                        </div>

                                        <!-- <input type="hidden" id="client_id" t-att-value="client.id"/> -->
                                        <div class="mt-3">
                                        </div>
                                    </div>

                                    <div class="border p-3 mb-3 rounded">
                                        <div class="form-check mb-2">
                                            <input type="checkbox" class="form-check-input" name="installation_schedule" id="installation_schedule" t-att-checked="'checked' if prod.installation_schedule else None" t-att-disabled="True"/>
                                            <label class="form-check-label fw-bold" for="handover">Installation Schedule</label>
                                            <input type="date" class="form-control mt-2" name="installation_schedule_date" id="installation_schedule_date" t-att-value="prod.installation_schedule_date or ''" t-att-readonly="'readonly' if prod.stage8 else None" t-att-disabled="True"/>
                                        </div>

                                        <div class="form-group mt-3">
                                            <label>Attachment</label>
                                            <t t-if="prod.installation_schedule_attachment">
                                                <a t-att-href="'/web/content/%s?download=true' % prod.installation_schedule_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                    <i class="fa fa-download fa-lg text-primary"></i>
                                                    <t t-esc="prod.installation_schedule_attachment.name"/>
                                                </a>
                                            </t>
                                            <input type="file" id="stage82_attachment" name="stage82_attachment" class="form-control" t-att-disabled="True"/>
                                        </div>

                                        <!-- <input type="hidden" id="client_id" t-att-value="client.id"/> -->
                                        <div class="mt-3">
                                        </div>
                                        <div class="form-group mt-3">
                                            <label for="installation_schedule_remark" class="fw-bold">Remark</label>
                                            <textarea class="form-control" id="installation_schedule_remark" name="installation_schedule_remark" rows="3" placeholder="Enter remark here..." t-att-readonly="'readonly' if prod.stage8 else None" t-att-disabled="'disabled' if prod.stage8 else None">
                                                <t t-esc="prod.installation_schedule_remark or ''"/>
                                            </textarea>
                                        </div>

                                    </div>

                                    <div class="border p-3 mb-3 rounded">
                                        <div class="form-check mb-2">
                                            <!-- <label class="form-check-label fw-bold" for="handover">Glass Schedule</label> -->
                                            <input type="checkbox" class="form-check-input" name="glass_schedule" id="glass_schedule" t-att-checked="'checked' if prod.glass_schedule else None" t-att-disabled="True"/>
                                            <label class="form-check-label fw-bold" for="handover">Glass Schedule</label>

                                        </div>
                                        <div class="form-group mt-3">
                                            <label class="form-check-label fw-bold" for="handover">Order Date</label>
                                            <br/>
                                            <input type="date" class="form-control mt-2" name="glass_schedule_date" id="glass_schedule_date" t-att-value="prod.glass_schedule_date or ''" t-att-readonly="'readonly' if prod.stage8 else None" t-att-disabled="True"/>
                                        </div>

                                        <div class="form-group mt-3">
                                            <label>delivery date</label>
                                            <t t-if="prod.glass_schedule_attachment">
                                                <a t-att-href="'/web/content/%s?download=true' % prod.glass_schedule_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                    <i class="fa fa-download fa-lg text-primary"></i>
                                                    <t t-esc="prod.glass_schedule_attachment.name"/>
                                                </a>
                                            </t>
                                            <input type="file" id="stage82_attachment" name="stage82_attachment" class="form-control" t-att-disabled="True"/>
                                        </div>

                                        <!-- <input type="hidden" id="client_id" t-att-value="client.id"/> -->
                                        <div class="mt-3">
                                        </div>
                                        <div class="form-group mt-3">
                                            <label for="glass_schedule_remark" class="fw-bold">Remark</label>
                                            <textarea class="form-control" id="glass_schedule_remark" name="glass_schedule_remark" rows="3" placeholder="Enter remark here..." t-att-readonly="'readonly' if prod.stage8 else None" t-att-disabled="'disabled' if prod.stage8 else None">
                                                <t t-esc="prod.glass_schedule_remark or ''"/>
                                            </textarea>
                                        </div>

                                    </div>


                                </form>
                            </div>



                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="stage8" t-att-checked="prod.stage8 and 'checked'" t-att-disabled="True" />
                                    <label class="form-check-label" for="stage8">
                            Stage 8 Completed
                                    </label>
                                </div>
                                <!-- <t t-if="not client.stage8"> -->
                                <!-- </t> -->
                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade" id="Cstage1Modal" tabindex="-1" aria-labelledby="stage1ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <!-- Left: Title -->
                                <h5 class="modal-title mb-0" id="stage1ModalLabel">Stage 1</h5>

                                <!-- Middle: Enable Checkbox with spacing -->
                                <div class="form-check ms-4">                                    <!-- Add margin-start -->
                                    <input class="form-check-input" type="checkbox"  t-att-checked="crm.site_visit and 'checked'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="site_visit">Enable</label>
                                </div>

                                <!-- Right: Close Button -->
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>


                            <!-- Modal Body -->
                            <div class="modal-body">

                                <div class="form-check" id="sitevisitdonee">
                                    <input class="form-check-input" type="checkbox"  t-att-checked="crm.site_visit_done and 'checked'" t-att-disabled="True" />
                                    <label class="form-check-label" for="site_visit_done">
                        Site Visit Confirmed
                                    </label>

                                    <div class="form-group mt-3">
                                        <label>Attachment</label>
                                        <t t-if="crm.stage11_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % crm.stage11_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"></i>
                                                <t t-esc="crm.stage11_attachment.name"/>
                                            </a>
                                        </t>
                                        <input type="file" id="stage1_attachment" class="form-control" t-att-disabled="True"/>
                                    </div>
                                </div>
                                

                            </div>
                            

                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"  t-att-checked="crm.stage1 and 'checked'" t-att-disabled="True" />
                                    <label class="form-check-label" for="stage1">
                            Stage 1 Completed
                                    </label>
                                </div>
                                
                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade" id="Cstage2Modal" tabindex="-1" aria-labelledby="stage2ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <h5 class="modal-title mb-0" id="stage2ModalLabel">Stage 2</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>

                            <div class="modal-body">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"  t-att-checked="crm.drawing_sent and 'checked'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="drawing_sent">Drawing Sent</label>
                                    <t t-if="crm.drawing_sent_attachment">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.drawing_sent_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"/>
                                            <t t-esc="crm.drawing_sent_attachment.name"/>
                                        </a>

                                    </t>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"  t-att-checked="crm.rev_1 and 'checked'" t-att-readonly="crm.rev_1 and 'readonly'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="Rev_1">Rev 1</label>
                                    <t t-if="crm.rev_1_attachment">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.rev_1_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"/>
                                            <t t-esc="crm.rev_1_attachment.name"/>
                                        </a>
                                    </t>
                                    <div id="rev_1_date_block">
                                        <input type="date" class="form-control mt-2" name="rev_1_date" id="rev_1_date" t-att-value="crm.rev_1_date or ''" t-att-disabled="True"/>
                                    </div>
                                </div>

                                <!-- Repeat for Rev 2–5 -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"  t-att-checked="crm.rev_2 and 'checked'" t-att-readonly="crm.rev_2 and 'readonly'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="Rev_2">Rev 2</label>
                                    <t t-if="crm.rev_2_attachment">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.rev_2_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"/>
                                            <t t-esc="crm.rev_2_attachment.name"/>
                                        </a>
                                    </t>
                                    <div id="rev_2_date_block">
                                        <input type="date" class="form-control mt-2" name="rev_2_date"  t-att-value="crm.rev_2_date or ''" t-att-disabled="True"/>
                                    </div>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"  t-att-checked="crm.rev_3 and 'checked'" t-att-readonly="crm.rev_3 and 'readonly'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="Rev_3">Rev 3</label>
                                    <t t-if="crm.rev_3_attachment">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.rev_3_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"/>
                                            <t t-esc="crm.rev_3_attachment.name"/>
                                        </a>
                                    </t>
                                    <div id="rev_3_date_block">
                                        <input type="date" class="form-control mt-2" name="rev_3_date"  t-att-value="crm.rev_3_date or ''" t-att-disabled="True"/>
                                    </div>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"  t-att-checked="crm.rev_4 and 'checked'" t-att-readonly="crm.rev_4 and 'readonly'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="Rev_4">Rev 4</label>
                                    <t t-if="crm.rev_4_attachment">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.rev_4_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"/>
                                            <t t-esc="crm.rev_4_attachment.name"/>
                                        </a>
                                    </t>
                                    <div id="rev_4_date_block">
                                        <input type="date" class="form-control mt-2" name="rev_4_date"  t-att-value="crm.rev_4_date or ''" t-att-disabled="True"/>
                                    </div>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"  t-att-checked="crm.rev_5 and 'checked'" t-att-readonly="crm.rev_5 and 'readonly'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="Rev_5">Rev 5</label>
                                    <t t-if="crm.rev_5_attachment">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.rev_5_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"/>
                                            <t t-esc="crm.rev_5_attachment.name"/>
                                        </a>
                                    </t>
                                    <div id="rev_5_date_block">
                                        <input type="date" class="form-control mt-2" name="rev_5_date"  t-att-value="crm.rev_5_date or ''" t-att-disabled="True"/>
                                    </div>
                                </div>

                                <div class="form-group mt-3">
                                    <label for="stage2_attachment">Upload Diagram (Choose revision):</label>
                                    <div class="d-flex gap-2 align-items-center">
                                        <select id="stage2_upload_tag" class="form-select w-25" t-att-disabled="True">
                                            <option value="drawing_sent">Drawing Sent</option>
                                            <option value="rev_1">Rev 1</option>
                                            <option value="rev_2">Rev 2</option>
                                            <option value="rev_3">Rev 3</option>
                                            <option value="rev_4">Rev 4</option>
                                            <option value="rev_5">Rev 5</option>
                                        </select>
                                        <input type="file"  class="form-control w-50" t-att-disabled="True"/>
                                    </div>
                                </div>
                                

                            </div>

                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"  t-att-checked="crm.stage2 and 'checked'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="stage2">Stage 2 Completed</label>
                                </div>
                                
                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade" id="Cstage6Modal" tabindex="-1" aria-labelledby="stage6ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <h5 class="modal-title mb-0" id="stage6ModalLabel">Stage 6</h5>


                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>

                            <!-- Modal Body -->
                            <div class="modal-body">
                                <div class="border p-3 mb-3 rounded">
                                    <div class="form-check mb-2">
                                        <input type="checkbox" class="form-check-input" name="material_dispatch"  t-att-checked="crm.material_dispatch and 'checked'" t-att-disabled="True"/>
                                        <label class="form-check-label fw-bold" for="material_dispatch">Material Dispatch</label>
                                    </div>
                                    <div class="mb-2">
                                        <label>Date:</label>
                                        <input type="date" class="form-control" name="material_dispatch_date"  t-att-value="crm.material_dispatch_date or ''" t-att-disabled="True"/>
                                    </div>
                                    <!-- <div class="mb-2">
                                        <label>Upload eBay Bill (Mandatory):</label>
                                        <input type="file" class="form-control" name="material_dispatch_attachment" required="true"/>
                                    </div> -->
                                    <div class="form-group mt-3">
                                        <label>Upload eBill:</label>
                                        <t t-if="crm.material_dispatch_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % crm.material_dispatch_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"/>
                                                <t t-esc="crm.material_dispatch_attachment.name"/>
                                            </a>
                                        </t>
                                        <input type="file" id="stage6_attachment" class="form-control" t-att-disabled="True"/>
                                    </div>
                                    
                                    <div class="mt-3">
                                        
                                    </div>
                                </div>

                                <!-- Material Delivery -->
                                <div class="border p-3 mb-3 rounded">
                                    <div class="form-check mb-2">
                                        <input type="checkbox" class="form-check-input" name="material_delivery"  t-att-checked="crm.material_delivery and 'checked'" t-att-disabled="True"/>
                                        <label class="form-check-label fw-bold" for="material_delivery">Material Delivery</label>
                                    </div>
                                    <div class="mb-2">
                                        <label>Date:</label>
                                        <input type="date" class="form-control" name="material_delivery_date"  t-att-value="crm.material_delivery_date or ''" t-att-disabled="True"/>
                                    </div>
                                </div>
                            </div>

                            <!-- Modal Footer -->
                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="stage6" t-att-checked="crm.stage6 and 'checked'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="stage6">
                            Stage 6 Completed
                                    </label>
                                </div>
                                
                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade" id="Cstage7Modal" tabindex="-1" aria-labelledby="stage7ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <h5 class="modal-title mb-0" id="stage7ModalLabel">Stage 7</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>

                            <!-- Modal Body -->
                            <div class="modal-body">
                                <div class="border p-3 mb-3 rounded">

                                    <!-- <div class="mb-2">
                                        <label>Amount:</label>
                                        <input type="number" class="form-control" name="preinstallation_amount" id="preinstallation_amount" t-att-value="client.preinstallation_amount or ''" t-att-disabled="client.preinstallation_amount and 'true'" required="true"/>
                                    </div> -->

                                    <div class="mb-3">
                                        <label for="start_installation">Start Installation:</label>
                                        <select class="form-select" name="start_installation"  t-att-disabled="True">
                                            <option t-att-selected="crm.start_installation=='yes'">Yes</option>
                                            <option t-att-selected="crm.start_installation=='no'">No</option>
                                        </select>
                                    </div>




                                    <div class="form-group mt-3">
                                        <label>Attachment</label>
                                        <t t-if="crm.preinstallation_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % crm.preinstallation_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"></i>
                                                <t t-esc="crm.preinstallation_attachment.name"/>
                                            </a>
                                        </t>
                                        <input type="file" id="stage7_attachment" class="form-control" t-att-disabled="True"/>
                                    </div>
                                    <div class="mt-3">
                                        <!-- <button type="button" class="btn btn-primary" onclick="uploadStage7Attachment()" t-att-disabled="client.preinstallation_attachment">Upload</button> -->
                                    </div>


                                </div>


                            </div>

                            <!-- Modal Footer -->
                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="stage7" t-att-checked="crm.stage7 and 'checked'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="stage7">
                            Stage 7 Completed
                                    </label>
                                </div>

                                
                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade" id="Cstage8Modal" tabindex="-1" aria-labelledby="stage8ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <h5 class="modal-title mb-0" id="stage8ModalLabel">Stage 8</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>

                            <!-- Modal Body -->
                            <div class="modal-body">
                                <div class="form-check mb-2">
                                    <input type="checkbox" class="form-check-input" name="ongoing"  t-att-checked="'checked' if crm.ongoing else None" t-att-disabled="True"/>
                                    <label class="form-check-label fw-bold" for="ongoing">Ongoing</label>
                                </div>

                                <div class="form-check mb-2">
                                    <input type="checkbox" class="form-check-input" name="completed"  t-att-checked="'checked' if crm.completed else None" t-att-disabled="True"/>
                                    <label class="form-check-label fw-bold" for="completed">Completed</label>
                                </div>

                                <div class="border p-3 mb-3 rounded">
                                    <div class="form-check mb-2">
                                        <input type="checkbox" class="form-check-input" name="handover"  t-att-checked="'checked' if crm.handover else None" t-att-disabled="True"/>
                                        <label class="form-check-label fw-bold" for="handover">Handover</label>
                                        <input type="date" class="form-control mt-2" name="handover_date"  t-att-value="crm.handover_date or ''" t-att-readonly="'readonly' if crm.handover_date or crm.stage8 else None" t-att-disabled="True"/>
                                    </div>

                                    <div class="form-group mt-3">
                                        <label>Attachment</label>
                                        <t t-if="crm.attachment_handover">
                                            <a t-att-href="'/web/content/%s?download=true' % crm.attachment_handover.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"></i>
                                            </a>
                                        </t>
                                        <input type="file" id="stage8_attachment" class="form-control" t-att-disabled="True"/>
                                    </div>

                                    <!-- <input type="hidden" id="client_id" t-att-value="client.id"/> -->
                                    <div class="mt-3">
                                        <!-- <button type="button" class="btn btn-primary" onclick="uploadStage8Attachment()" t-att-disabled="client.stage8">Upload</button> -->
                                    </div>
                                </div>

                            </div>

                            <!-- Modal Footer -->
                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="stage8" t-att-checked="'checked' if crm.stage8 else None" t-att-disabled="True"/>
                                    <label class="form-check-label" for="stage8">Stage 8 Completed</label>
                                </div>
                                
                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade" id="Cstage9Modal" tabindex="-1" aria-labelledby="stage9ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <h5 class="modal-title mb-0" id="stage9ModalLabel">Stage 9</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>

                            <!-- Modal Body -->
                            <div class="modal-body">
                                <div class="border p-3 mb-3 rounded">

                                    <div class="form-check mb-2">
                                        <!-- AMC Checkbox -->
                                        <input type="radio" class="form-check-input" name="type"  t-att-checked="'checked' if crm.amc else None" t-att-disabled="True"/>
                                        <label class="form-check-label fw-bold" for="amc">AMC</label>

                                        <!-- AMC Start & End Dates -->
                                        <div class="mt-2">
                                            <label class="form-label" for="amc_start_date">Start Date</label>
                                            <input type="date" class="form-control" name="amc_start_date"  t-att-value="crm.amc_start_date or ''" t-att-disabled="True"/>

                                            <label class="form-label mt-2" for="amc_end_date">End Date</label>
                                            <input type="date" class="form-control" name="amc_end_date" id="amc_end_date" t-att-value="crm.amc_end_date or ''" t-att-disabled="True"/>
                                        </div>
                                        <!-- t-att-readonly="'readonly' if client.amc_end_date else None" -->
                                        <div class="mt-3 ps-3" id="renew_block">
                                            <label class="form-label fw-bold">Renewal</label>
                                            <br/>

                                            <div class="d-flex gap-4">
                                                <!-- Renew -->
                                                <div class="form-check form-check-inline">
                                                    <input type="radio" class="form-check-input" name="renew_choice" id="renew" value="renew" t-att-checked="'checked' if crm.renew else None" t-att-disabled="True"/>
                                                    <label class="form-check-label" for="renew">Renew</label>
                                                </div>

                                                <!-- Not Renew -->
                                                <div class="form-check form-check-inline">
                                                    <input type="radio" class="form-check-input" name="renew_choice" id="not_renew" value="not_renew" t-att-checked="'checked' if crm.not_renew else None" t-att-disabled="True"/>
                                                    <label class="form-check-label" for="not_renew">Not Renew</label>
                                                </div>
                                            </div>

                                            <!-- Renew Date -->
                                            <div class="mt-2" id="renew_date_block">
                                                <label class="form-label" for="renew_date">Renew Date</label>
                                                <input type="date" class="form-control" name="renew_date" id="renew_date" t-att-value="crm.renew_date or ''" t-att-disabled="True" />
                                            </div>
                                        </div>

                                    </div>

                                </div>

                                <div class="form-check mb-2">
                                    <input type="radio" class="form-check-input" name="type" id="service" t-att-checked="'checked' if (crm.service) else None" t-att-disabled="True"/>
                                    <label class="form-check-label fw-bold" for="service">Service</label>
                                </div>


                            </div>

                            <!-- Modal Footer -->
                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="stage9" t-att-checked="crm.stage9 and 'checked'" t-att-disabled="True" />
                                    <label class="form-check-label" for="stage9">
                            Stage 9 Completed
                                    </label>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade" id="Cstage5Modal" tabindex="-1" aria-labelledby="stage5ModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">

                            <!-- Header -->
                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <h5 class="modal-title mb-0" id="stage5ModalLabel">Stage 5</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>

                            <!-- Body -->
                            <div class="modal-body">

                                <!-- Readiness Notification -->
                                <div class="form-check mb-3">
                                    <input type="checkbox" class="form-check-input" name="readiness_notification" id="readiness_notification" t-att-checked="crm.readiness_notification and 'checked'" t-att-disabled="True"/>
                                    <label class="form-check-label fw-bold" for="readiness_notification">
                        Readiness Notification
                                    </label>
                                </div>

                                <!-- Advance Paid -->
                                <div class="border p-3 mb-3 rounded">
                                    <h6 class="fw-bold">Advance Paid</h6>
                                    <div class="mb-2">
                                        <label>Percentage:</label>
                                        <input type="number" min="1" max="100" class="form-control" name="advance_paid_percentage" id="advance_paid_percentage" t-att-value="crm.advance_paid_percentage or ''" t-att-disabled="True" oninput="if (this.value &gt; 100) this.value = 100; if (this.value &lt; 0) this.value = 0;"/>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input type="checkbox" class="form-check-input" name="advance_paid_checkbox" id="advance_paid_checkbox" t-att-checked="crm.advance_paid_checkbox and 'checked'" t-att-disabled="True"/>
                                        <label class="form-check-label" for="advance_paid_checkbox">Advance Paid</label>
                                    </div>
                                    <div class="mb-2">
                                        <label>Amount:</label>
                                        <input type="number" class="form-control" name="advance_paid_amount" id="advance_paid_amount" t-att-value="crm.advance_paid_amount or ''" t-att-disabled="True"/>
                                    </div>
                                    <div class="form-group mt-3">
                                        <label>Upload Payment Receipt:</label>
                                        <t t-if="crm.advance_paid_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % crm.advance_paid_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"/>
                                                <t t-esc="crm.advance_paid_attachment.name"/>
                                            </a>
                                        </t>
                                        <input type="file" id="stage51_attachment" class="form-control" t-att-disabled="True"/>
                                    </div>
                                    
                                    <div class="mt-3">
                                    </div>
                                </div>

                                <!-- Readiness Collected -->
                                <div class="border p-3 mb-3 rounded">
                                    <h6 class="fw-bold">Readiness Collected</h6>
                                    <div class="mb-2">
                                        <label>Percentage:</label>
                                        <input type="number" min="1" max="100" class="form-control" name="readiness_collected_percentage" id="readiness_collected_percentage" t-att-value="crm.readiness_collected_percentage or ''" t-att-disabled="True" oninput="if (this.value &gt; 100) this.value = 100; if (this.value &lt; 0) this.value = 0;"/>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input type="checkbox" class="form-check-input" name="readiness_collected_checkbox" id="readiness_collected_checkbox" t-att-checked="crm.readiness_collected_checkbox and 'checked'" t-att-disabled="True"/>
                                        <label class="form-check-label" for="readiness_collected_checkbox">Advance Paid</label>
                                    </div>
                                    <div class="mb-2">
                                        <label>Amount:</label>
                                        <input type="number" class="form-control" name="readiness_collected_amount" id="readiness_collected_amount" t-att-value="crm.readiness_collected_amount or ''" t-att-disabled="True"/>
                                    </div>
                                    <div class="form-group mt-3">
                                        <label>Upload Payment Receipt:</label>
                                        <t t-if="crm.readiness_collected_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % crm.readiness_collected_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"/>
                                                <t t-esc="crm.readiness_collected_attachment.name"/>
                                            </a>
                                        </t>
                                        <input type="file" id="stage52_attachment" class="form-control" t-att-disabled="True"/>
                                    </div>
                                    <div class="mt-3">
                                    </div>
                                </div>

                                <!-- Handover Done -->
                                <div class="border p-3 mb-3 rounded">
                                    <h6 class="fw-bold">Handover Done</h6>
                                    <div class="mb-2">
                                        <label>Percentage:</label>
                                        <input type="number" min="1" max="100" class="form-control" name="handover_percentage" id="handover_percentage" t-att-value="crm.handover_percentage or ''" t-att-disabled="True" oninput="if (this.value &gt; 100) this.value = 100; if (this.value &lt; 0) this.value = 0;"/>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input type="checkbox" class="form-check-input" name="handover_checkbox" id="handover_checkbox" t-att-checked="crm.handover_checkbox and 'checked'" t-att-disabled="True"/>
                                        <label class="form-check-label" for="handover_checkbox">Advance Paid</label>
                                    </div>
                                    <div class="mb-2">
                                        <label>Amount:</label>
                                        <input type="number" class="form-control" name="handover_amount" id="handover_amount" t-att-value="crm.handover_amount or ''" t-att-disabled="True"/>
                                    </div>
                                    <div class="form-group mt-3">
                                        <label>Upload Payment Receipt:</label>
                                        <t t-if="crm.handover_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % crm.handover_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"/>
                                                <t t-esc="crm.handover_attachment.name"/>
                                            </a>
                                        </t>
                                        <input type="file" id="stage53_attachment" class="form-control" t-att-disabled="True"/>
                                    </div>
                                    
                                    <div class="mt-3">
                                    </div>
                                </div>

                                <!-- Balance -->
                                <div class="border p-3 mb-3 rounded">
                                    <h6 class="fw-bold">Balance</h6>
                                    <div class="mb-2">
                                        <label>Percentage:</label>
                                        <input type="number" min="1" max="100" class="form-control" name="balance_percentage" id="balance_percentage" t-att-value="crm.balance_percentage or ''" t-att-disabled="True" oninput="if (this.value &gt; 100) this.value = 100; if (this.value &lt; 0) this.value = 0;"/>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input type="checkbox" class="form-check-input" name="balance_checkbox" id="balance_checkbox" t-att-checked="crm.balance_checkbox and 'checked'" t-att-disabled="True"/>
                                        <label class="form-check-label" for="balance_checkbox">Advance Paid</label>
                                    </div>
                                    <div class="mb-2">
                                        <label>Amount:</label>
                                        <input type="number" class="form-control" name="balance_amount" id="balance_amount" t-att-value="crm.balance_amount or ''" t-att-disabled="True"/>
                                    </div>
                                    <div class="form-group mt-3">
                                        <label>Upload Payment Receipt:</label>
                                        <t t-if="crm.balance_attachment">
                                            <a t-att-href="'/web/content/%s?download=true' % crm.balance_attachment.id" target="_blank" class="ms-2" title="Download Attachment">
                                                <i class="fa fa-download fa-lg text-primary"/>
                                                <t t-esc="crm.balance_attachment.name"/>
                                            </a>
                                        </t>
                                        <input type="file" id="stage54_attachment" class="form-control" t-att-disabled="True"/>
                                    </div>
                                    
                                    <div class="mt-3">
                                    </div>
                                </div>

                            </div>

                            <!-- Footer -->
                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"  t-att-checked="crm.stage5 and 'checked'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="stage5">
                        Stage 5 Completed
                                    </label>
                                </div>
                                
                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade" id="Cstage3Modal" tabindex="-1" aria-labelledby="stage3ModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">

                            <!-- Header -->
                            <div class="modal-header">
                                <h5 class="modal-title" id="stage3ModalLabel">Stage 3</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>

                            <!-- Body -->
                            <div class="modal-body">
                                <!-- Main Checkbox -->
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="finishes_form" t-att-checked="crm.finishes_form and 'checked'" t-att-disabled="True"/>
                                    <label class="form-check-label fw-bold" for="finishes_form">Finishes Forms</label>
                                </div>

                                <!-- Upload Section -->
                                <label class="form-label fw-bold">Upload Documents</label>

                                <!-- COP/Accent -->
                                <div class="mb-3">
                                    <label for="cop_accent" class="form-label">COP/Accent</label>
                                    <t t-if="crm.cop_accent">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.cop_accent.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"></i>
                                            <t t-esc="crm.cop_accent.name"/>
                                        </a>
                                    </t>

                                    <div class="input-group">
                                        <input type="file" class="form-control" id="cop_accent" name="cop_accent" t-att-disabled="True"/>

                                    </div>
                                </div>

                                <!-- Cabin/Interiors -->
                                <div class="mb-3">
                                    <label for="cabin_interiors" class="form-label">Cabin/Interiors</label>
                                    <t t-if="crm.cabin_interiors">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.cabin_interiors.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"></i>
                                            <t t-esc="crm.cabin_interiors.name"/>
                                        </a>
                                    </t>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="cabin_interiors" name="cabin_interiors" t-att-disabled="True"/>

                                    </div>
                                </div>

                                <!-- Doors -->
                                <div class="mb-3">
                                    <label for="doors" class="form-label">Doors</label>
                                    <t t-if="crm.doors">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.doors.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"></i>
                                            <t t-esc="crm.doors.name"/>
                                        </a>
                                    </t>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="doors" name="doors" t-att-disabled="True"/>

                                    </div>
                                </div>

                                <!-- Ceiling -->
                                <div class="mb-3">
                                    <label for="ceiling" class="form-label">Ceiling</label>
                                    <t t-if="crm.ceiling">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.ceiling.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"></i>
                                            <t t-esc="crm.ceiling.name"/>
                                        </a>
                                    </t>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="ceiling" name="ceiling" t-att-disabled="True"/>

                                    </div>
                                </div>

                                <!-- CabinRel Color -->
                                <div class="mb-3">
                                    <label for="cabin_rel_color" class="form-label">CabinRel Color</label>
                                    <t t-if="crm.cabin_rel_color">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.cabin_rel_color.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"></i>
                                            <t t-esc="crm.cabin_rel_color.name"/>
                                        </a>
                                    </t>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="cabin_rel_color" name="cabin_rel_color" t-att-disabled="True"/>

                                    </div>
                                </div>

                                <!-- Flooring -->
                                <div class="mb-3">
                                    <label for="flooring" class="form-label">Flooring</label>
                                    <t t-if="crm.flooring">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.flooring.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"></i>
                                            <t t-esc="crm.flooring.name"/>
                                        </a>
                                    </t>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="flooring" name="flooring" t-att-disabled="True"/>

                                    </div>
                                </div>

                                <!-- Glass Wall 1 -->
                                <div class="mb-3">
                                    <label for="glass_wall_1" class="form-label">Glass Wall 1</label>
                                    <t t-if="crm.glass_wall_1">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.glass_wall_1.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"></i>
                                            <t t-esc="crm.glass_wall_1.name"/>
                                        </a>
                                    </t>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="glass_wall_1" name="glass_wall_1" t-att-disabled="true"/>

                                    </div>
                                </div>

                                <!-- Glass Wall 2 -->
                                <div class="mb-3">
                                    <label for="glass_wall_2" class="form-label">Glass Wall 2</label>
                                    <t t-if="crm.glass_wall_2">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.glass_wall_2.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"></i>
                                            <t t-esc="crm.glass_wall_2.name"/>
                                        </a>
                                    </t>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="glass_wall_2" name="glass_wall_2" t-att-disabled="True"/>

                                    </div>
                                </div>

                                <!-- Outer Shaft Color -->
                                <div class="mb-3">
                                    <label for="outer_shaft_color" class="form-label">Outer Shaft Color</label>
                                    <t t-if="crm.outer_shaft_color">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.outer_shaft_color.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"></i>
                                            <t t-esc="crm.outer_shaft_color.name"/>
                                        </a>
                                    </t>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="outer_shaft_color" name="outer_shaft_color" t-att-disabled="True"/>

                                    </div>
                                </div>

                                <!-- Others -->
                                <div class="mb-3">
                                    <label for="others" class="form-label">Others</label>
                                    <t t-if="crm.others">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.others.id" target="_blank" class="ms-2" title="Download Attachment">
                                            <i class="fa fa-download fa-lg text-primary"></i>
                                            <t t-esc="crm.others.name"/>
                                        </a>
                                    </t>
                                    <div class="input-group">
                                        <input type="file" class="form-control" id="others" name="others" t-att-disabled="True"/>

                                    </div>
                                </div>

                                <!-- Remarks -->
                                <div class="mb-3 mt-3">
                                    <label for="remarks" class="form-label fw-bold">Remark</label>
                                    <textarea id="remarks" name="remarks" class="form-control" rows="3" t-esc="crm.finishes_remarks or ''" t-att-disabled="True"/>
                                </div>
                            </div>

                            <!-- Footer -->
                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="stage3" t-att-checked="crm.stage3 and 'checked'" t-att-disabled="True" />
                                    <label class="form-check-label" for="stage3">
                    Stage 3 Completed
                                    </label>
                                </div>
                                
                            </div>

                        </div>
                    </div>
                </div>

                <div class="modal fade" id="Cstage4Modal" tabindex="-1" aria-labelledby="stage4ModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header d-flex justify-content-between align-items-center">
                                <h5 class="modal-title mb-0" id="stage4ModalLabel">Stage 4</h5>


                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                            </div>

                            <!-- Modal Body -->
                            <div class="modal-body">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="redinessform" t-att-checked="crm.redinessform and 'checked'" t-att-disabled="True"/>
                                    <label class="form-check-label" for="redinessform">Readiness Form</label>
                                </div>

                                <t t-if="crm.redinessform_attachment">
                                    <!-- Download Link -->
                                    <div class="mt-3">
                                        <a t-att-href="'/web/content/%s?download=true' % crm.redinessform_attachment.id" class="btn btn-success btn-sm" target="_blank">
                                            <t t-esc="crm.redinessform_attachment.name"/>
                                        </a>

                                        <!-- Delete Button -->
                                       
                                    </div>
                                </t>
                                <t t-else="">
                                    <!-- Upload Field -->
                                    <div class="form-group mt-3">
                                        <label for="stage3_attachment">Upload Attachment:</label>
                                        <input type="file" id="stage3_attachment" class="form-control" t-att-disabled="True"/>
                                    </div>
                                    
                                    <div class="mt-3">
                                        <!-- <button type="button" class="btn btn-primary" onclick="uploadStage3Attachment()" t-att-disabled="client.stage4">Upload</button> -->
                                    </div>
                                </t>
                            </div>

                            <!-- Modal Footer -->
                            <div class="modal-footer">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="stage4" t-att-checked="crm.stage4 and 'checked'" t-att-disabled="True" />
                                    <label class="form-check-label" for="stage4">
                    Stage 4 Completed
                                    </label>
                                </div>
                               
                            </div>

                        </div>
                    </div>
                </div>

            <!-- Bootstrap 5 JS (if not already loaded on your website pages) -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"/>
            <script>
 
    document.addEventListener("DOMContentLoaded", function () {
        const stageSelect = document.getElementById("stage_id_select");
        const nextDateInput = document.getElementById("next_followup_date");
        const followupDescriptionInput = document.getElementById("followup_description");

        function toggleNextFollowupRequirement() {
            const selectedOption = stageSelect.options[stageSelect.selectedIndex];
            const selectedText = selectedOption ? selectedOption.text.trim() : "";

            if (selectedText === "Won") {
                nextDateInput.removeAttribute("required");
                followupDescriptionInput.removeAttribute("required");
                // Optional: Hide field completely
                // document.getElementById("next_followup_date_wrapper").style.display = "none";
            } else {
                nextDateInput.setAttribute("required", "true");
                followupDescriptionInput.setAttribute("required", "true");
                // document.getElementById("next_followup_date_wrapper").style.display = "block";
            }
            if (selectedText === "Lost") {
                nextDateInput.removeAttribute("required");
                followupDescriptionInput.removeAttribute("required");
                // Optional: Hide field completely
                // document.getElementById("next_followup_date_wrapper").style.display = "none";
            } else {
                nextDateInput.setAttribute("required", "true");
                followupDescriptionInput.setAttribute("required", "true");
                // document.getElementById("next_followup_date_wrapper").style.display = "block";
            }
        }

        stageSelect.addEventListener("change", toggleNextFollowupRequirement);
        toggleNextFollowupRequirement(); // run on load
    });


    document.addEventListener('DOMContentLoaded', function () {
        const stageSelect = document.getElementById('stage_id_select');
        const wonNoteDiv = document.getElementById('won_note_wrapper');

        function toggleWonNote() {
            const selectedText = stageSelect.options[stageSelect.selectedIndex].text.trim().toLowerCase();
            if (selectedText === 'won') {
                wonNoteDiv.style.display = 'block';
            } else {
                wonNoteDiv.style.display = 'none';
            }
        }

        stageSelect.addEventListener('change', toggleWonNote);
        toggleWonNote(); // Run on page load in case "Won" is already selected
    });
            </script>
        </t>
    </template>

    <template id="lead_followups_list_template" name="Lead Followups List">
        <t t-call="website.layout">
            <div class="container mt-4 mb-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <!-- Breadcrumb -->
                    <nav aria-label="breadcrumb" class="mb-0">
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="/Dashboard">
                                    <i class="bi bi-house-door"/>
 Home</a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="#">Lead Followups</a>
                            </li>
                            <!-- <li class="breadcrumb-item active" aria-current="page">Create</li> -->
                        </ol>
                    </nav>

                    <!-- Back Button -->
                    <a href="/Dashboard" class="btn btn-dark">← Back</a>
                </div>
                <div>
                    <div style="padding:15px; background:white;">
                        <table id="lead_followup_table" class="table table-bordered table-striped">
                            <thead class="table-light">
                                <tr>
                                    <th>S No</th>
                                    <th>Lead Name</th>
                                    <th>Mobile</th>
                                    <th>Alternate Mobile</th>
                                    <th>Location</th>
                                    <th>Lead Stage</th>
                                    <th>Last Followup</th>
                                    <th>Last Followup Details</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="followups" t-as="f" t-foreach-index="f_index">
                                    <tr>
                                        <td>
                                            <t t-esc="f_index + 1"/>
                                        </td>
                                        <td>
                                            <span class="badge bg-danger">
                                                <a t-att-href="'/lead_followups/edit/%d' % f.id" class="btn btn-danger btn-sm">
                                        FollowUp
                                                </a>
                                            </span>
                                            <t t-esc="f.lead_id.name"/>
                                        </td>
                                        <td>
                                            <t t-esc="f.mobile or 'N/A'"/>
                                        </td>
                                        <td>
                                            <t t-esc="f.alternate_mobile or 'N/A'"/>
                                        </td>
                                        <td>
                                            <t t-esc="f.lead_id.city or ''"/>
                                        </td>
                                        <td>
                                            <t t-esc="f.stage_id.name"/>
                                        </td>
                                        <td>
                                            <t t-esc="f.next_followup_date or ''"/>
                                        </td>
                                        <td>
                                            <t t-esc="f.followup_description or ''"/>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>

                        </table>
                    </div>
                </div>
            </div>

            <!-- DataTables -->
            <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"/>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"/>
            <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"/>
            <script>
                $(document).ready(function() {
                    $('#lead_followup_table').DataTable({
                        "pageLength": 10,
                        <!-- "lengthChange": false, -->
                        "ordering": true
                    });
                });
            </script>
        </t>
    </template>
</odoo>
